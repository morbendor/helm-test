{{- if include "update-image-pull-secrets-job.shouldRun" . }}
apiVersion: batch/v1
kind: CronJob
metadata:
  name: update-image-pull-secrets-cron-{{ .Release.Namespace }}
spec:
  schedule: "{{ .Values.jobs.updateImagePullSecrets.cron }}"
  failedJobsHistoryLimit: 1
  successfulJobsHistoryLimit: 0
  jobTemplate:
    spec:
      activeDeadlineSeconds: 300
      template:
{{- include "update-image-pull-secrets-job.podTemplate" . | nindent 8 }}
---
apiVersion: batch/v1
kind: Job
metadata:
  name: update-image-pull-secrets-once-{{ .Release.Namespace }}
  annotations:
   "helm.sh/hook": "post-install,post-upgrade"
   "helm.sh/hook-delete-policy": "before-hook-creation,hook-succeeded"
   "helm.sh/hook-weight": "-1"
spec:
  activeDeadlineSeconds: 300
  backoffLimit: 2
  template:
{{- include "update-image-pull-secrets-job.podTemplate" . | nindent 4 }}
{{- end }}